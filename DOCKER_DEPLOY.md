# ğŸ³ Docker éƒ¨ç½²æŒ‡å—

## ç¯å¢ƒè¦æ±‚

- Docker 19.03.0+
- Docker Compose 1.29.0+

## ä½¿ç”¨ Docker Compose éƒ¨ç½²

### 1. å…‹éš†é¡¹ç›®

```bash
git clone <é¡¹ç›®åœ°å€>
cd ioe
```

### 2. é…ç½®ç¯å¢ƒå˜é‡ï¼ˆå¯é€‰ï¼‰

å¦‚éœ€è‡ªå®šä¹‰é…ç½®ï¼Œå¯ä»¥ä¿®æ”¹ `docker-compose.yml` æ–‡ä»¶ä¸­çš„ç¯å¢ƒå˜é‡ï¼Œä¸»è¦åŒ…æ‹¬ï¼š
- æ•°æ®åº“é…ç½®ï¼ˆPOSTGRES_*ï¼‰
- Django é…ç½®ï¼ˆDJANGO_*ï¼‰
- é‚®ä»¶é…ç½®ï¼ˆEMAIL_*ï¼‰
- è¶…çº§ç®¡ç†å‘˜è´¦æˆ·ï¼ˆDJANGO_SUPERUSER_*ï¼‰
- API å¯†é’¥é…ç½®ï¼ˆBARCODE_API_KEY, ALI_BARCODE_APPCODEï¼‰

### 3. å¯åŠ¨æœåŠ¡

```bash
# æ„å»ºå¹¶å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker compose up -d

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker compose ps

# æŸ¥çœ‹æœåŠ¡æ—¥å¿—
docker compose logs -f
```

### 4. è®¿é—®ç³»ç»Ÿ

æœåŠ¡å¯åŠ¨åï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹åœ°å€è®¿é—®ï¼š
- ä¸»ç³»ç»Ÿï¼šhttp://localhost:8000
- ç®¡ç†åå°ï¼šhttp://localhost:8000/admin

é»˜è®¤è¶…çº§ç®¡ç†å‘˜è´¦æˆ·ï¼š
- ç”¨æˆ·åï¼šadmin
- å¯†ç ï¼šadmin123

## æ•°æ®æŒä¹…åŒ–

ç³»ç»Ÿä½¿ç”¨ Docker volumes å®ç°æ•°æ®æŒä¹…åŒ–ï¼ŒåŒ…æ‹¬ï¼š
- `postgres_data`ï¼šæ•°æ®åº“æ–‡ä»¶
- `media_volume`ï¼šç”¨æˆ·ä¸Šä¼ çš„åª’ä½“æ–‡ä»¶
- `backup_volume`ï¼šç³»ç»Ÿå¤‡ä»½æ–‡ä»¶
- `temp_volume`ï¼šä¸´æ—¶æ–‡ä»¶
- `log_volume`ï¼šåº”ç”¨æ—¥å¿—
- `static_volume`ï¼šé™æ€æ–‡ä»¶
- `redis_data`ï¼šRedis ç¼“å­˜æ•°æ®

## æœåŠ¡è¯´æ˜

ç³»ç»ŸåŒ…å«ä»¥ä¸‹ Docker æœåŠ¡ï¼š
1. **web**ï¼šDjango åº”ç”¨ä¸»æœåŠ¡
   - è¿è¡Œåœ¨ 8000 ç«¯å£
   - ä½¿ç”¨ Gunicorn ä½œä¸º WSGI æœåŠ¡å™¨
   - è‡ªåŠ¨è¿›è¡Œæ•°æ®åº“è¿ç§»å’Œé™æ€æ–‡ä»¶æ”¶é›†

2. **db**ï¼šPostgreSQL æ•°æ®åº“æœåŠ¡
   - ç‰ˆæœ¬ï¼šPostgreSQL 15
   - è¿è¡Œåœ¨ 5432 ç«¯å£
   - è‡ªåŠ¨åˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ·

3. **redis-ioe**ï¼šRedis ç¼“å­˜æœåŠ¡
   - ç‰ˆæœ¬ï¼šRedis 7
   - è¿è¡Œåœ¨ 6379 ç«¯å£
   - å¯ç”¨æ•°æ®æŒä¹…åŒ–

## å¸¸ç”¨æ“ä½œå‘½ä»¤

```bash
# åœæ­¢æ‰€æœ‰æœåŠ¡
docker compose down

# é‡å¯ç‰¹å®šæœåŠ¡
docker compose restart web

# æŸ¥çœ‹æœåŠ¡æ—¥å¿—
docker compose logs -f web

# è¿›å…¥å®¹å™¨æ‰§è¡Œå‘½ä»¤
docker compose exec web bash

# å¤‡ä»½æ•°æ®åº“
docker compose exec db pg_dump -U postgres ioe > backup.sql

# æ¢å¤æ•°æ®åº“
docker compose exec -T db psql -U postgres ioe < backup.sql
```

## æ³¨æ„äº‹é¡¹

1. é¦–æ¬¡å¯åŠ¨æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ï¼š
   - åˆ›å»ºæ•°æ®åº“è¡¨
   - æ”¶é›†é™æ€æ–‡ä»¶
   - åˆ›å»ºè¶…çº§ç®¡ç†å‘˜è´¦æˆ·

2. ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å»ºè®®ï¼š
   - ä¿®æ”¹é»˜è®¤çš„æ•°æ®åº“å¯†ç 
   - æ›´æ”¹è¶…çº§ç®¡ç†å‘˜å¯†ç 
   - é…ç½® HTTPS
   - è®¾ç½®é€‚å½“çš„ ALLOWED_HOSTS
   - å…³é—­ DEBUG æ¨¡å¼ 